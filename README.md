# Alarm Video Recorder to Zabbix Forwarder

Проект принимает алерты от видеорегистратора и перенаправляет их в систему мониторинга Zabbix.  
Также при необходимости отправляет уведомления в Telegram.

---

## Описание

- Запускается TCP-сервер, который слушает указанный порт.
- При получении события от видеорегистратора данные обрабатываются и фильтруются.
- Поддерживаются только события типа `Alarm`, исключая `HumanDetect`.
- Информация отправляется в Zabbix через Zabbix sender.
- При включённой опции отправляет уведомления в Telegram.

---

## Требования

- Python 3.11+
- Docker и Docker Compose (опционально, для контейнерного запуска)
- Доступ к серверу Zabbix с разрешением на приём данных через Zabbix Sender
- Telegram бот (если требуется отправка уведомлений в Telegram)

---

## Настройка и запуск

### 1. Клонирование репозитория

```bash
git clone <URL_репозитория>
cd <папка_проекта>
```

### 2. Создание и настройка файла `.env`

Переименнуйте файл `.env_template` в `.env` в корне проекта и заполните его следующими параметрами:

```env
# Настройки Telegram
TELEGRAM_BOT_TOKEN=ваш_токен_бота
TELEGRAM_CHAT_ID=ваш_chat_id
SEND_MESSAGE=True  # или False, если не нужно отправлять сообщения в Telegram

# Настройки TCP-сервера
HOST=0.0.0.0
PORT=15002  # Порт для прослушивания входящих соединений

# Настройка подключения к Zabbix
IP_ZABBIX=ip_сервера_zabbix
PORT_ZABBIX=10051  # Обычно порт Zabbix sender по умолчанию
```

### 3. Запуск с помощью Docker Compose (рекомендуется)

Убедитесь, что Docker и Docker Compose установлены и запущены.

```bash
docker-compose up --build -d
```

- Контейнер будет слушать порт, указанный в `.env` (переменная `PORT`).
- Логи можно просмотреть командой:

```bash
docker logs -f alarm_videoreg
```

### 4. Ручной запуск без Docker

Убедитесь, что у вас установлен Python 3.11 и виртуальное окружение (рекомендуется).

```bash
python -m venv venv
source venv/bin/activate  # Linux/macOS
venv\Scripts\activate     # Windows

pip install -r requirements.txt
```

Запустите сервер:

```bash
python main.py
```

---

## Структура проекта

- `main.py` — точка входа, TCP-сервер для приёма сообщений.
- `config.py` — загрузка настроек из `.env`.
- `handlers.py` — обработка и фильтрация полученных событий.
- `logger.py` — настройка логгера.
- `telegram.py` — отправка сообщений в Telegram (при необходимости).
- `utils.py` — вспомогательные функции.
- `zbx.py` — модуль отправки данных в Zabbix.
- `docker-compose.yml` — конфигурация для запуска через Docker Compose.
- `Dockerfile` — образ для контейнеризации.
- `.env` — файл с конфигурацией (не входит в репозиторий, создаётся вручную).

---

## Логирование

Логи выводятся в консоль. Рекомендуется настроить сбор и ротацию логов на уровне сервера или Docker.

---

## Примечания

- Убедитесь, что ваш сервер Zabbix настроен на приём данных от внешних агентов (Zabbix Sender).
- Порт, указанный в `PORT`, должен быть открыт для приёма входящих соединений от видеорегистратора.
- Для корректной работы Telegram уведомлений необходимы валидные токен и chat_id.

---

## Контакты и поддержка

Если возникнут вопросы или проблемы, пожалуйста, создайте issue в репозитории или свяжитесь с разработчиком.

---

Спасибо за использование проекта!

